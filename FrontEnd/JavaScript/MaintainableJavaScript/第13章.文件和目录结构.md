# 自动化 - 第 13 章. 文件和目录结构

>《编写可维护的 JavaScript》—— Nicholas C. Zakas

在开始构建你的系统之前首先要确定如何组织你的文件和目录，项目类型决定了目录结构。如果项目是一个独立的 JavaScript 类库，其结构肯定与网站项目的结构不同。

## 1. 最佳实践

抛开项目类型不谈，总有一些适用于 JavaScript 文件和目录结构的最佳实践。

**一个文件只包含一个对象**：

每个 JavaScript 文件应该只包含一个 JavaScript 对象的代码，这种模式在其他编程语言中很常见，可使代码更易于维护。

这样做降低了多人同时修改同一文件的风险。
尽管现在的代码版本管理工具（SVN、CVS、GIT）很容易合并两个人的修改，但是人就会有合并冲突的情况发生。
文件越少，合并时冲突的可能性就越大，保持每个文件只有一个 JavaScript 对象降低了这种风险。

**相关的文件置于同一目录**：

如果你有多个相关联的对象，就把这些文件都放在同一个目录下。
例如，一个模块有多个文件的代码组成，那么把这个模块包含的所有文件放在一个目录下就很有意义。
给相关的文件分组有助于开发者更容易定位功能。

**保持第三方代码的独立**：

第三方代码应当独立于项目工程之外。
比如一个 JavaScript 类库，最理想的情况是根本不引入这样一个 JavaScript 类库，而直接从 CDN 加载它。
把这些第三方文件单独放置在项目工程中的一个目录里，是一种最佳的替代方案。

**明确源码目录**：

创建的 JavaScript 文件应当放置在一个完全独立的目录里，而不应该置于项目中。
网站应该使用编译后的目录，而不应该使用源码目录。
不要把编译后的代码提交到源代码中，因为编译后内容都是成型的，在部署到线上之前，会多次编译。

**保持测试代码的完整性**：

JavaScript 测试代码也也应当提交到项目中。

如果你的 JavaScript 不是一个独立的 JavaScript 项目，而是大型网站或 Web 应用的一部分，
文件和目录的结构基本上由服务器端使用的框架所决定。
即使项目的目录结构千变万化，但总会有一个子目录（如 js、scripts、javascript）单独用于存放 JavaScript，
针对这个目录，有几种常见的目录结构划分。

## 2. 基本结构

JavaScript 目录下放置如下三个主要目录是很流行的做法：

* `build` 或 `dist`：用来放置最终构建后的文件，理想情况下这个目录不应该提交
* `src`：用来放置所有的源文件，通常每个功能划分一个子目录
* `test` 或 `tests`：用来放置所有的测试文件，与 `src` 目录的结构一一对应

## 3. CSS Lint 项目结构

[CSS Lint](https://github.com/stubbornella/csslint) 项目结构：

```text
csslint/
  demos/
  dist/   # 始终包含最新的稳定发行版本。build + release
  lib/    # 第三方库
  src/    # 按功能划分子目录
    cli/
    core/
      CSSLint.js  # 源文件
    formatters/
    rules/
    workder/
  tasks/
  tests/  # 目录结构与 src 一一对应
    cli/
    core/
      CSSLint.js  # 对应的测试文件
    formatters/
    rules/
    workder/
```

## 4. jQuery 项目结构

[jQuery](https://github.com/jquery/jquery) 项目结构

```text
jquery/
  build/
  dist/
  external/   # 第三方库
  src/
    ajax/
    core/
    ajax.js
    core.js
  test/
    unit/
      ajax.js
      core.js
  .gitignore
  README.md
  package.json
```

`src` 目录下直接放置核心功能文件，核心功能文件对应的子目录存放相关的资源文件和扩展

`src/ajax.js` 的测试文件为 `test/unit/ajax.js`