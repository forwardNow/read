# 编程实践

## 1. x1

## 2. x2

## 3. x3

## 4. x4

## 5. x5

## 6. x6

## 7. 事件处理

在所有 JavaScript 应用中事件处理都非常重要。所有的 JavaScript 均通过事件绑定到 UI 上，所以大多数前端工程师需要花费很多时间来编写和修改事件处理程序。

遗憾的是，在 JavaScript 诞生之初，这部分内容并未受到太多重视。甚至当开发者们开始热衷于将传统的软件架构概念融入到 JavaScript 里时，事件绑定仍然没有收到多大重视。

大多数事件处理相关的代码和事件环境紧紧耦合在一起，导致可维护性很糟糕。

### 7.1. 典型用法

多数开发者都很了解，当事件触发时，事件对象（event 对象）会作为回调参数传入事件处理程序中。

event 对象包含所有和事件相关的信息，包括事件的宿主（target）以及其他和事件类型相关的数据。

鼠标事件会将其位置信息暴露在 event 对象上，键盘事件会将按键的信息暴露在 event 对象，触屏事件会将触摸位置和持续时间（duration）暴露在 event 对象上。只有提供了所有这些信息，UI 才会正确地执行交互。

在很多场景中，你只是用到了 event 所提供信息的一小部分，如下

```javascript
// 不好的写法
function handleClick(event) {
  var popup = document.getElementById('popup');
  popup.style.left = event.clientX + 'px';
  popup.style.top = event.clientY + 'px';
  popup.className = 'reveal';
}

element.addEventListener('click', handleClick, false);
```

这段代码只用到了 event 对象的两个属性：clientX 和 clientY。在将元素显示在页面之前先用这两个属性给它做定位。尽管这段代码看起来非常简单且没有什么问题，但实际上是不好的写法，因为这种做法有其局限性。

### 7.2. 规则 1 - 隔离应用逻辑

上述代码的第一个问题是事件处理程序包含了应用逻辑（application logic）。

应用逻辑是和应用相关的功能性代码，而不是和用户行为相关的。

上述代码中：

* 应用逻辑 是在特定位置显示弹出框。
* 用户行为 是点击鼠标

将应用逻辑从事件处理程序中抽离出来的做法是一种最佳实践，因为其他地方可能会用到同一段逻辑，这时就可以复用，比如：

* 用户将鼠标移到某个元素上时，判断是否显示弹出框
* 按下键盘上的某个键时，显示弹出框

将应用逻辑放置于事件处理程序中的另一个问题与测试有关。测试时需要直接触发功能代码，而不是通过模拟对元素的单击来触发。

如果将应用逻辑放置于事件处理程序中，唯一的测试方法是制造事件的触发。

应该将应用逻辑和事件处理的代码拆分开来，重构如下：

```javascript
var MyApp = {
  handleClick: function(event) {
    this.showPopup(event);
  },

  showPopup: function(event) {
    var popup = document.getElementById('popup');
    popup.style.left = event.clientX + 'px';
    popup.style.top = event.clientY + 'px';
    popup.className = 'reveal';
  }
}

element.addEventListener('click', function(event) {
  MyApp.handleClick(event);
});
```

应用逻辑被转移到 `MyApp.showPopup()` 方法中了；`MyApp.handleClick()` 方法只做一件事，即调用 `MyApp.showPopup()` 方法。

应用逻辑被玻璃出去后，同一段功能代码可以应用于多处，而不依赖于特定事件的触发，这显然更方便，但这只是拆解事件处理程序代码的第一步。