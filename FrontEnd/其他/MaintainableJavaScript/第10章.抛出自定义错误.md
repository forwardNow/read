# 编程实践

## 1. x1

## 2. x2

## 3. x3

## 4. x4

## 5. x5

## 6. x6

## 7. x7

## 8. x8

## 9. x9

## 10. 第 10 章.抛出自定义错误

在 JavaScript 中抛出错误是一门艺术，明白代码中哪些地方合适抛出错误是需要时间的。一旦搞明白这一点，调试代码的时间将大大缩段。

### 10.1. 错误的本质

当某些非期望的事情发生时，程序就引发一个错误，也许是给函数传递了不正确的值，或者数学运算碰到了一个无效的操作数。

编程语言定义了一组基本的规则，当偏离了这些规则时将导致错误，然后开发者能修复错误。

如果错误没有被抛出或者报告给你，调试将会非常困难；如果所有失败都是悄无声息的，那将消耗你大量的时间发现它，更不要说单独隔离并修复它。

所以错误是开发者的朋友，而不是敌人。

错误常常在非期望的地方、不恰当的时机跳出来，这很麻烦。更糟糕的是，默认的错误消息通常太简洁而无法解释到底什么东西出错了。

JavaScript 错误消息以消息稀少、隐晦含糊而被人所不喜，特别是在老版本 IE 中，这会让问题更加复杂化。

如果跳出的错误能像这样描述：“由于这个原因，该函数调用失败”。那么，调试将会非常简单，这正是抛出自己的错误的好处。

像失败案例一样来考虑错误是非常有帮助的。在代码的某个特殊的地方处理失败，比在所有地方预期失败要简单地多。

在产品设计上，这是非常普遍的实践经验。汽车有碰撞吸收区域，这些区域框架的设计旨在撞击发生时，以可预测的方式毁坏。知道一个碰撞发生时，碰撞框架将如何反应（哪些部分将失败），制造商将能保证乘客的安全，你的代码也可以用这种方法来创建。

### 10.2. 在 JavaScript 中抛出错误

使用 `throw` 操作符抛出一个 `Error` 对象。

```javascript
throw new Error("Something bad happened.");
```

内置的 `Error` 类型在所有的 JavaScript 实现中都是有效的，它只接受一个参数，即错误消息（message）。当抛出的 `Error` 类的对象没有被捕获时，浏览器会在控制台显示构造器中的 message 字符串。

如果抛出的值一个不是 `Error` 类的对象，不是所有浏览器都会按你预期显示错误消息，

```javascript
// 不好的写法
throw "messaage";
throw { name: "Nicholas" };
throw true;
throw 123456;
throw new Date();
```

### 10.3. 抛出错误的好处

抛出自己的错误可以明确告知别人错误的原因，有助于调试。如总是在错误消息中包含函数名称。

```javascript
function getById(id) {
  if (typeof id === "string" && id.length > 0) {
    return document.getElementById(id);
  } else {
    throw new Error("getById(): Argument must be a string.");
  }
}
```

### 10.4. 何时抛出错误

理解如何抛出错误是一方面，另一方面要理解在什么时候抛出错误。

由于 JavaScript 没有类型检查和参数检查，大量的开发者错误地认为应该实现每个函数的类型检查。这种做法并不实际，并且会对脚本的整体性能造成影响。如下面的函数，它试图实现充分的类型检查。

```javascript
// 不好的写法：检查了太多的错误
function addClass(element, className) {
  if (!element || typeof element.className !== "string") {
    throw new Error("addClass(): First argument must be a DOM element.");
  }

  if (typeof className !== "string") {
    throw new Error("addClass(): Second argument must be a string.");
  }

  element.className += " " + className;
}
```