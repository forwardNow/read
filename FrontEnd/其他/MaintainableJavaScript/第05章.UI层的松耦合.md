# 编程实践

## 1. x1

## 2. x2

## 3. x3

## 4. x4

## 5. 第 5 章 UI层的松耦合

在 Web 开发中，用户界面（User Interface，UI）是由三个彼此隔离又相互作用的层定义的。

* HTML 定义页面的数据
* CSS 给页面添加样式，创建视觉特征
* JavaScript 给页面添加行为，使之更具交互性

三者之间的关系（Web UI 分层）

```text
  |------------------------|
  |   CSS  |  JavaScript   |
  |------------------------|
  |          HTML          |
  |------------------------|
```

CSS、JavaScript 都依赖 HTML。

### 5.1. 什么是松耦合

很多设计模式就是为了解决耦合的问题。如果两个组件耦合太紧，则说明一个组件和另一个组件直接关联，这样的话，如果修改一个组件的逻辑，那么另外一个组件的逻辑也需要修改。

比如，有一个 `.error` 的 CSS 类，在很多页面都用到了，你突然觉得 `.error` 不合适，想改名为 `.warning`。这时，你不仅需要改动 CSS 文件，还需要改动所有用到该 CSS 类的 HTML 文件。这说明 HTML 和 CSS 紧耦合。

当你能够做到修改一个组件而不需要改动其他组件时，你就做到了松耦合。对于多人大型系统来说，有很多人参与维护代码，松耦合对于代码可维护性来说至关重要。你绝对希望开发人员在修改某部分代码时不会破坏其他人的代码。

当一个大系统的每个组件的内容有了限制，就做到了松耦合。本质上讲，每个组件需要保持职责单一来确保松耦合。组件知道的越少，就越有利于形成整个系统。

需要注意：在一起工作的组件无法达到“无耦合”（no coupling）。在所有系统中，组件之间总要共享一些信息来完成各自的工作。我们的目标是确保一个组件的修改不会经常性地影响其他部分。

如果一个 Web UI 是松耦合的，则很容易调试。

* 文本或结构相关的问题，查找 HTML 即可
* 样式相关的问题，查找 CSS 即可
* 行为相关的问题，查找 JavaScript 即可

### 5.2. 将 JavaScript 从 CSS 中抽离

在 IE8 以及之前的版本中，可以使用 CSS 表达式（CSS expression）。

CSS 表达式允许你将 JavaScript 直接插入 CSS 中，如下

```css
/* 不好的写法 */
.box {
  width: expression(document.body.offsetWidth + 'px');
}
```

CSS 表达式被包裹在一个特殊的 `expression()` 函数中，可以给它传入任意 JavaScript 代码。浏览器会以高频率重复计算 CSS 表达式，这严重影响了性能。

幸运的是 IE9 不再支持 CSS 表达式了。

### 5.3. 将 CSS 从 JavaScript 中抽离

保持 CSS 和 JavaScript 之间清晰的分离。

将 CSS 类选择器作为 CSS 和 JavaScript 之间通信的桥梁。JavaScript 通过 `element.className` 随意添加和删除 CSS 类选择器；CSS 类选择器的样式在任何时候都是可以修改的，且不必更新 JavaScript。

JavaScript 不应当直接操作样式，以便保持和 CSS 的松耦合；如果要给某个元素重新进行绝对定位，则还是需要使用到 `style.top` 直接操作样式。

```javascript
// 不好的写法
element.style.color = 'red';
element.style.background = 'yellow';

// 不好的写法
element.style.cssText = 'color: red; background: yellow;';

// 好的写法
/*
  .active {
    color: red;
    background: yellow;
  }
 */
element.className =+ ' active';

element.classList.add('active');
```

### 5.4. 将 JavaScript 从 HTML 中抽离

```html
<!-- 不好的写法 -->
<button onclick="doSomething()">Click Me</button>
```

通过 on 属性来绑定事件处理程序，造成两个 UI 层（HTML 和 JavaScript）的深耦合。存在两个问题：

* 当点击按钮时，`doSomething()` 函数必须存在
* 修改 `doSomething()` 的函数名时需要同时修改两处（典型的紧耦合）

```html
<!-- 不好的写法 -->
<script>
function doSomething(){
  // ......
}
</script>
```

绝大多数 JavaScript 代码都应该包含在外部文件，通过 `<script src="1.js">` 引入。

确保在 HTML 代码中不会有内联的 JavaScript 代码。这么做的原因是出于紧急调试的考虑的。

当 JavaScript 报错，你的下意识行为应当是去 JavaScript 文件中查找原因。如果在 HTML 中包含 JavaScript 代码，则会打断你的调试流程，而且 HTML 中的代码也不好打断点调试。

可预见性（Predictability）会提高调试和开发效率，并确信从何入手调试 bug，这会让问题解决得更快、代码总体质量更高。