# 第 8 章：小程序基础库的更新迭代

小程序平台正式发布后，收到许多开发者的反馈，其中有Bug类的反馈，也有向我们提出某些具体需求的。程序总有出错的时候，小程序的底层也有出现重大 Bug 的现象发生，一旦这种Bug出现，会影响到很多小程序的正常工作，因此我们需要迅速进行修复。同时，我们也以小步快跑的方式发布很多新的能力供开发者使用，所以小程序的底层基础库迭代速度是非常快。在这一章我们会介绍小程序基础库是如何进行更新迭代的。

## 1. 小程序基础库

我们在第三章提到过小程序的运行环境是分成渲染层和逻辑层的，我们在渲染层可以用各类组件组建界面的元素，在逻辑层可以用各类API来处理各种逻辑，这里提到的组件、API其实都是小程序基础库进行包装提供的，基础库的职责还要处理数据绑定、组件系统、事件系统、通信系统等一系列框架逻辑，才能让整个小程序有序的运作起来。小程序的基础库是JavaScript编写的，它可以被注入到渲染层和逻辑层运行。为了叙述方便，下文我们把小程序基础库简称为基础库。

### 1.1. 基础库载入时机

我们在开发网页时，经常会引用很多开源的JS库，在使用到这些库所提供的 API 前，我们需要先在业务代码前边引入这些库，如代码 8-1 所示，我们在使用 jQuery 库的$函数前，需要在业务代码前用 script 标签先引入 jQuery.js。

代码清单8-1 在HTML引入其他JS库:

```html
<script src="jQuery.js"></script>
<script src="Vue.js"></script>
<script>
  $(function() {
    // console.log("ready")
  })
</script>
```

同样道理，为了让小程序业务代码能够调用 `wx.navigateTo` 等 API 以及组件，就需要在启动小程序后先载入基础库，接着再载入业务代码。由于小程序的渲染层和逻辑层是两个线程管理，渲染层 WebView 层注入的称为 WebView 基础库，逻辑层注入的称为 AppService 基础库，如果没有特殊声明，后文提到基础库的概念指的是 WebView 基础库和 AppService 基础库两个的组合。

显然，所有小程序在微信客户端打开的时候，都需要注入相同的基础库 ，所以，小程序的基础库不会被打包在某个小程序的代码包里边，它会被提前内置在微信客户端。这样做的好处有两点：

* 降低业务小程序的代码包大小。
* 可以单独修复基础库中的 Bug，无需修改到业务小程序的代码包。

