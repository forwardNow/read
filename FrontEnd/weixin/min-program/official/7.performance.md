# 第 7 章：性能优化

之前的章节已经介绍了小程序的编写方法和基础原理。本章将进一步介绍一些运行细节，以及针对性的优化策略。

## 1. 启动

在小程序启动时，微信会为小程序展示一个固定的启动界面，界面内包含小程序的图标、名称和加载提示图标。此时，微信会在背后完成几项工作：下载小程序代码包、加载小程序代码包、初始化小程序首页。

图7-1 小程序启动流程图：

* ![图7-1 小程序启动流程图](./images/7/1.png)

### 1.1. 代码包下载

在某个小程序第一次启动时，微信需要下载小程序代码包。此后，如果小程序代码包未更新且还被保留在缓存中，则下载小程序代码包的步骤会被跳过。下载到的小程序代码包不是小程序的源代码，而是编译、压缩、打包之后的代码包。代码包大小可以在开发者工具的“详情”栏中找到。
从开发者的角度看，控制代码包大小有助于减少小程序的启动时间。对低于1MB的代码包，其下载时间可以控制在929ms（iOS）、1500ms（Android）内。

以下是一些常规的控制代码包大小的方法。

* 精简代码，去掉不必要的WXML结构和未使用的WXSS定义。
* 减少在代码包中直接嵌入的资源文件。
* 压缩图片，使用适当的图片格式。

如果小程序比较复杂，优化后的代码总量可能仍然比较大，此时可以采用分包加载的方式进行优化。
