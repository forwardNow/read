 # JS的类

JS从创建之初就不支持类，
也没有把类继承作为定义相似对象以及关联对象的主要方式。

很多库都创建了一些工具，让JS显得貌似能支持类，导致ES6最终引入了类。

ES6的类并不与其他语言的类完全相同，
所具备的独特性正配合了JS的动态本质。

## 1. ES5中的仿类结构

ES6之前不存在类，但与类最接近的是：
创建一个构造器，然后将方法指派到该构造器的原型上。

这种方式通常被称为创建一个自定义类型，如：

    function PersonType( name ) {
        this.name = name;
    }
    PersonType.prototype.sayName = function () {
        console.info( this.name );
    }
    let person = new PersonType( "吴钦飞" );
    person.sayName(); //=> 吴钦飞

    person instanceof PersonType; //=> true
    person instanceof Object; //=> true


使用 `new` 运算符创建了 `PersonType` 的一个新实例 `person`，
此对象会被认为是一个通过原型继承了 `PersonType` 与 `Object` 的实例。

这种基本模式在许多对类进行模拟的JS库中都存在，而这也是ES6类的出发点。

## 2. 类的声明

### 2.1. 基本的类声明

格式：class 类名 对象字面量的简写形式。

    class PersonClass {
        // <==> PersonType的构造器
        constructor( name ) {
            this.name = name;
        }

        // <==> PersonType.prototype.sayName
        syaName() {
            console.info( this.name );
        }
    }
    let person = new PersonClass( "吴钦飞" );
    person.sayName();

    typeof PersonClass; //=> "function"

`PersonClass` 实际上创建了一个拥有 `constructor` 方法及其行为的函数。

> 自有属性：own properties，该属性出现在实例上而不是原型上，
只能在类的构造器或方法内部进行创建。
建议在构造器函数内创建所有可能出现的自有属性，
这样在类中声明变量就会被限制在单一位置（有助于代码检查）。

相对于已有的自定义类型声明方式来说，
类声明仅仅是以它为基础的一个语法糖。

### 2.2. 为何要使用类的语法

类与自定义类型的区别：
* 类声明不会被提升。在程序的执行到达声明处之前，类都存在暂时性死区。
* 类声明中的所有代码都自动运行在严格模式下
* 类的所有方法都不可枚举
* 类的所有方法内部都没有`[[Construct]]`，因此使用`new`调用会报错
* 调用类构造器时不使用`new`，会抛异常。
* 视图在类的方法内部重写类名，会抛出错误.

等价于一下未使用类语法的代码:

    let PersonType = (function() {
        "use strict";

        const PersonType = function( name ) {
            if ( typeof new.target === "undefined" ) {
                throw new Error( "Constructor must be called with new." );
            }
            this.name = name;
        };

        Object.defineProperty( PersonType.prototype, "sayName", {
            value: function () {
                if ( typeof new.target !== "undefined" ) {
                    throw new Error("Method cannot be called with new.");
                }
                console.info( this.name );
            },
            enumerable: false,
            writable: true,
            configurable: true
        } );

        return PersonType;
    })();

上例说明了尽管不使用新语法也能实现类的任何特性，但类语法显著简化了所有功能的代码。

## 3. 类表达式

类和函数都有两种形式：声明和表达式。

类表达式被设计用于变量声明、或可作为参数传递给函数。

### 3.1. 基本的类表达式

    let Person = class {
        constructor( name ) {
            this.name = name;
        }
        sayName() {
            console.info( this.name );
        }
    };

### 3.2. 具名类表达式

    let Person = class Person2 {
        constructor( name ) {
            this.name = name;
        }
        sayName() {
            console.info( this.name );
        }
    };

`Person2` 只能在类的内部使用，在外部使用为 `undefined`