# 1.1 生成 HTTP 请求消息

## 1.1.1 探索之旅从输入网址开始

* 网址,准确来说应该叫 URL（以 http:// 开头的那一串东西）
* 除了“http:”,网址还可以以其他一些字符开头,
  例如“ftp:”“file:” “mailto:” 等
* 如果没有正确配置电子邮件软件,
  则即使在地址栏中输入“mailto:”也是无法正常工作的。
  
**为什么有各种各样的URL呢？**
  
  * 尽管我们通常是使用浏览器来访问 Web 服务器的，
    但实际上浏览器并不只有这一个功能
  * 它也可以用来在 FTP 服务器上下载和上传文件，
    同时也具备电子邮件客户端的功能。
  * 可以说,浏览器是一个具备多种客户端功能的综合性 客户端软件  
  * 因此它需要一些东西来判断应该使用其中哪种功能来访问相应的数据，
    而各种不同的 URL 就是用来干这个的，
    比如访问 Web 服务器时用“http:”， 而访问 FTP 服务器时用“ftp:”。
    
**互联网中常见的几种 URL**

 * 根据访问目标的不同, URL 的写法也会不同
 * 用HTTP协议访问Web服务器时
    * http://user:password@www.glasscom.com:80/dir/file1.htm 
 * 用FTP协议下载和上传文件时
    * ftp://user:password@ftp.glasscom.com:21/dir/file1.htm
 * 读取客户端计算机本地文件时
    * file://localhost/c:/path/file1.zip
 * 发送电子邮件时
    * mailto:tone@glasscom.com
 * 阅读新闻组的文章时
    * news:comp.protocols.tcp-ip
    
**URL 开头的文字，表示浏览器应当使用的访问方法**

 * “http:” “ftp:” “file:” “mailto:”
 * 当访问 Web 服务器时应该使用 HTTPA 协议，
   访问 FTP 服务器时则应该使用 FTP 协议 
 * 我们可以把这部分理解为访问时使用的协议类型 
 
## 1.1.2 浏览器先要解析 URL

 * 浏览器要做的第一步工作就是对 URL 进行解析,
   从而生成发送给 Web 服务器的请求消息。
 * 当对 URL 进行解析时,首先需要将其中的各个元素拆分出来  
 * 如：http://www.lab.glasscom.com/dir1/file1.html
   =>
   http: + // + www.lab.glasscom.com + / + dir1 + / + file1.html
   
## 1.1.3 省略文件名的情况

### (a) http://www.lab.glasscom.com/dir/
 * URL 是以“/”来结尾
 * 可以理解为, 以“/”结尾代表 /dir/ 后面本来应该有的文件名被省略了
 * 没有文件名,服务器怎么知道要访问哪个文件呢？
 * 我们会在服务器上事先设置好文件名省略时要访问的默认文件名  
 * 这个设置根 据服务器不同而不同,
   大多数情况下是 index.html 或者 default.htm 之类的文件名 

### (b) http://www.lab.glasscom.com/
 * 以“/”结尾的，只有 Web 服务器的域名的
 * 也就是说它表示访问一个名叫“/”的目录
 * 由于省略了文件名,
   所以结果就是访问 /index.html 或者 /default.htm 这样的文件了
 * “/”目录表示目录层级中最顶层的“根目录”。
   
### (c) http://www.lab.glasscom.com
 * 连结尾的“/”都省略了
 * 当没有路径名时,就代表访问根目录下事先设置的默认文件,
   也就是 /index. html 或者 /default.htm 这些文件
   
### (d) http://www.lab.glasscom.com/whatisthis
 * 如果 Web 服务器上存在名为 whatisthis 的文件,
   则将 whatisthis 作为文件名来处理
 * 如果存在名为 whatisthis 的目录,
   则将 whatisthis 作为目录名来处理
   
## 1.1.4 HTTP 的基本思路 

 * 解析完 URL 之后,我们就知道应该要访问的目标在哪里了。
   接下来, 浏览器会使用 HTTP 协议来访问 Web 服务器
 * HTTP 协议定义了客户端和服务器之间如何进行交互（消息内容和步骤）。
 
### 请求消息

 * 客户端会向服务器发送请求消息，
   请求中包含两部分：“对什么” “进行怎样的操作”  
 * “对什么”的部分称为 URI，
   URI 的内容是一个存放网页数据的文件名 或者是 一个 CGI 程序的文件名。
 * CGI 程序:对 Web 服务器程序调用其他程序的规则所做的定义就是 CGI,
   而按照 CGI 规范来工作的程序就称为 CGI 程序。
 * 实际上,这个文件在 Web 服务器上未必是真实存在的,
   因为 Web 服务器可以通过重写规则对虚拟的 URI 进行映射。
 * “进行怎样的操作”的部分称为方法,也叫 HTTP 谓词,或者 HTTP 动词。
   表示需要让 Web 服务器完成怎样的工作
 * HTTP 的主要方法 
    * GET: 
        获取 URI 指定的信息。
        如果 URI 指定的是文件,则 返回文件的内容;
        如果 URI 指定的是 CGI 程序,则 返回该程序的输出数据
    * POST:
        从客户端向服务器发送数据。
        一般用于发送表单中 填写的数据等情况下
 * HTTP 消息中还有一些用来表示附加信息的 头字段。
   客户端向 Web 服务器发送数据时,会先发送头字段,然后再发送数据。
   不过,头字段属于可有可无的附加信息   
   
### 响应消息

 * 收到请求消息之后,Web 服务器会对其中的内容进行解析,
   通过 URI 和方法来判断“对什么”“进行怎样的操作”,
   并根据这些要求来完成自己的工作,
   然后将结果存放在响应消息中.
 * 在响应消息的开头有一个状态码, 
   它用来表示操作的执行结果是成功还是发生了错误。
 * 当我们访问 Web 服务器时,
   遇到找不到的文件就会显示出404 Not Found的错误信息,其实这就是状态码。
 * 状态码后面就是头字段和网页数据。
 * 响应消息会被发送回客户端,客户端收到之后,
   浏览器会从消息中读出所需的数据并显示在屏幕上。
   
### 关于 HTTP 方法的知识
 
 * 最常用的一个就是 GET 方法了,
   一般当我们访问 Web 服务器获取网页数据时,使用的就是 GET 方法。
   所谓一般的访问过程大概就是这样的:
    * 首先,在请求消息中写上 GET 方法, 
      然后在 URI 中写上存放网页数据的文件名“/dir1/file1.html”,
      这就表示我 们需要获取 /dir1/file1.html 文件中的数据。
    * 当 Web 服务器收到消息后,
      会打开 /dir1/file1.html 文件并读取出里面的数据,
      然后将读出的数据存放到响应消息中,并返回给客户端。
    * 最后,客户端浏览器会收到这些数据并显示在屏幕上。
 * 还有一个经常使用的方法就是 POST。
   我们在表单中填写数据并将其 发送给 Web 服务器时就会使用这个方法。
   当我们在网上商城填写收货地址和姓􏰀名,或者是在网上填写问卷时,
   都会遇到带有输入框的网页,而这些可以输入信息的部分就是表单。
   * 使用 POST 方法时,
     URI 会指向 Web 服务器中运行的一个应用程序的文件名,
     典型的例子包括“index.cgi”“index. php”等
   * 然后,在请求消息中,除了方法和 URI 之外,
     还要加上传递给应用程序和脚本的数据。
     这里的数据也就是用户在输入框里填写的信息。
   * 当服务器收到消息后,
     Web 服务器会将请求消息中的数据发送给 URI 指定的应用程序。
   * 最后,Web 服务器从应用程序接收输出的结果,
     会将它存放到响应消息中并返回给客户端。
     
 ## 1.1.5 生成 HTTP 请求消息
    
 * 对 URL 进行解析之后,浏览器确定了 Web 服务器和文件名,
   接下来就是根据这些信息来生成 HTTP 请求消息了。
 * HTTP 消息在格式上是有严格规定的,
   浏览器会按照规定的格式来生成请求消息 
 
 ### 请求消息

    请求行：< 方法 >< 空格 >< URI >< 空格 >< HTTP版本 >
    消息头：< 字段名 >:< 字段值 >
    空行
    消息体
 
 * 第一行称为请求行
    * 最开头的方法 是重点，
      方法可以告诉 Web 服务器它应该进行怎样的操作
    * URI：/< 目录名 >/.../< 文件名 >。（从 URL 中提取）
    * HTTP版本：表示该消息是基于哪个版本的 HTTP 规格编写的
 * 第二行为消息头
    * 尽管通过第一行我们就可以大致理解请求的内容,
      但有些情况下还需要一些额外的详细信息,
      而消息头的功能就是用来存放这些信息。 
    * 消息头的规格中定义了很多项目,
      如日期、客户端支持的 数据类型、语言、压缩格式、
      客户端和服务器的软件名称和版本、数据有效期和最后更新时间等
    * 这些项目表示的都是非常细节的信息,
      因此要想准确理解这些信息的意思,
      就需要对 HTTP 协议有非常深入的了解。 
 * 空行
 * 消息体
    * 也就是消息的主体
    * 不过,在使用 GET 方法的情况下,
      仅凭方法和URI,Web 服务器就能够判断需要进行怎样的操作,
      因此消息体中不需要填写任何数据。
    * 当使用 POST 方法时,需要将表单中填写的信息写在消息体中。
      到此为止,请求消息的生成操作就全部完成了。
      
## 1.1.6 发送请求后会收到响应 

 * 浏览器将请求消息发送出去之后,Web 服务器会返回响应消息。   
 * 响应响应消息的格式与请求消息相同，差别只在第一行上
 * 在响应消息中,第一行的内容为状态码和响应短语,
   用来表示请求的执行结果是成功还是出错。
 * 状态码和响应短语表示的内容一致,但它们的用途不同。
    * 状态码是一个数字,它主要用来向程序告知执行的结果
    * 响应短语则是一段文字,用来向人们告知执行的结果。
    
**HTTP 状态码概要**

 * 状态码的第一位数字表示状态类型,
   第二、三位数字表示具体的情况。
   
        1xx 告知请求的处理进度和情况
        2xx 成功
        3xx 表示需要进一步操作
        4xx 客户端错误
        5xx 服务器错误

**返回响应消息之后**
 * 浏览器会将数据提取出来并显示在屏幕上, 
   我们就能够看到网页的样子了。
 * 如果网页的内容只有文字,那么到这里就全部处理完毕了,
   但如果网页中还包括图片等资源,则还有下文。
   
**当网页中包含图片时**
 * 网页代码中的相应位置嵌入表示图片文件的标签（&lt;img>）。
 * 浏览器会在显示文字时搜索相应的标签,当遇到图片相关的标签时,
   会在屏幕上留出用来显示图片的空间,
   然后再次访问 Web 服务器,
   按照标签中指定的文件名向 Web 服务器请求获取相应的图片,
   并显示在预留的空间中。
 * 这个步骤和获取网页文件时一样,
   只要在 URI 部分（&lt;img src=URI>）写上图片的文件名,
   并生成和发送请求消息就可以了.
**请求**
 * 由于每条请求消息中只能写 1 个URI, 所以每次只能获取 1 个文件, 
   如果需要获取多个文件, 必须对每个文件单独发送 1 条请求。   
 * 比如 1 个网页中包含 3 张图片,
   那么获取网页加上获取图片,一共需要向 Web 服务器发送 4 条请求。
**web服务器处理单独的请求**
 * 判断所需的文件,然后获取这些文件并显示在屏幕上,
   这一系列工作的整体指挥也是浏览器的任务之一,
   而 Web 服务器却毫不知情。
 * Web 服务器完全不关心这 4 条请求获取的文件
   到底是 1 个网页上的还是不同网页上的,
   它的任务就是对每一条单独的请求返回 1 条响应而已。
 
 