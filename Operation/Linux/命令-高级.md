# 命令-高级

## 1. `hostname`

操作服务器的主机名（读取/设置），主要是读取主机名，用此命令设置的主机名是临时的。

一般是装系统时自动生成的名称。

```shell
# 完整的主机名
➜  ~ hostname
iz8rrzrale48hez

# 当前主机名称中的 FQDN（全限定域名）
➜  ~ hostname -f
```

## 2. `id`

查看用于的基本信息（用户 ID，用户组 ID，附加组 ID）。

一个用户可以归属于多个附加组（groups）。

```shell
# 当前用户的信息
➜  ~ id
uid=0(root) gid=0(root) groups=0(root)

# 指定用户的信息
➜  ~ id root
```

查看用户信息(uid、gid)

```shell
➜  ~ cat /etc/passwd | grep 'root'
root:x:0:0:root:/root:/bin/zsh
```

查看用户组信息(groups)

```shell
➜  ~ cat /etc/group | grep 'root'
root:x:0:
```

## 3. `whoami`

获取当前用户的用户名。一般用于 shell 脚本，获取当前操作用户的用户名，方便记录日志。

```shell
➜  ~ whoami
root
```

## 4. `ps -ef`

查看服务器的进程信息。

选项

* `-e` 等价于 `-A`，列出全部的进程
* `-f` 显示全部的信息类别

```shell
➜  ~ ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 Oct03 ?        00:00:02 /usr/lib/systemd/systemd --system --deserialize 18
root      9661     1  0 Oct06 ?        00:02:14 mongod
root     10532 10530  0 07:44 pts/1    00:00:00 -zsh
root     11279 10532  0 12:09 pts/1    00:00:00 ps -ef
root      4711     1  0 Oct04 ?        00:00:00 nginx: master process nginx
nginx     4713  4711  0 Oct04 ?        00:00:00 nginx: worker process
```

* `UID`：执行该进程的用户的 ID
* `PID`：该进程的 ID
* `PPID`：该进程的父级进程 ID；如果 PPID 没有，则为僵尸进程（无用进程）
* `C`：CPU 占用的百分比
* `STIME`：该进程的开始时间
* `TTY`：终端设备，`?` 表示该进程不是由终端发起的
* `TIME`：执行的时间
* `CMD`：进程的名称或路径

查看某个进程的状态

```shell
➜  ~ ps -ef | grep 'nginx'
root      4711     1  0 Oct04 ?        00:00:00 nginx: master process nginx
nginx     4713  4711  0 Oct04 ?        00:00:00 nginx: worker process
```

## 5. `top`

查看服务器的进程占用资源情况。

* 进入：`top`
* 退出：`q`

进入后，可使用的快捷键

* `M`：按内存降序排列
* `p`：按CPU降序排列
* `1`：展开 CPU 核心
* `e`：切换内存显示单位

```shell
➜  ~ top
# top - 12:29:24   ：执行 top 命令的时间
# up 3 days, 18:21 ：服务器运行了 3 天 18 小时 21 分
# load average: 0.00, 0.01, 0.05：负载情况（1分钟，5分钟，15分钟）
top - 12:29:24 up 3 days, 18:21,  1 user,  load average: 0.00, 0.01, 0.05
# 任务：总共 65， 运行 1，睡眠 64，停止 0，僵尸进程 0
Tasks:  65 total,   1 running,  64 sleeping,   0 stopped,   0 zombie
# CPU 情况
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
# 内存情况
KiB Mem :  1016164 total,   266944 free,   152368 used,   596852 buff/cache
# 交互区情况
KiB Swap:        0 total,        0 free,        0 used.   688608 avail Mem

# PID ：进程 ID
# USER ：哪个用户执行的该进程
# PR：进程的优先级
# NI：(略)
# VIRT：虚拟内存。进程申请 100 MB(虚拟内存)，使用了 30 MB(常驻内存)。
# RES：常驻内存。如果该进程掉了其他进程，其他进程占用的内存被包含在 RES 中。
# SHR：共享内存。调用的其他进程所占用的内存。所有该进程实际使用的内存应该为 RES - SHR。
# S：status，进程的状态。'R' 表示 running，'S' 表示 sleeping。
# %CPU：CPU 占用比例
# %MEM：内存 占用比例
# TIME+：进程已经执行的时间
# COMMAND：进程的名称或路径
  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
  911 root      20   0  131680   7720   5608 S  0.7  0.8  14:02.69 AliYunDun
 9661 root      25   5 1014484  56348  14028 S  0.3  5.5   2:16.90 mongod
11444 root      20   0  157584   2072   1500 R  0.3  0.2   0:00.03 top
    1 root      20   0   43172   3324   2268 S  0.0  0.3   0:02.78 systemd
    2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd
    3 root      20   0       0      0      0 S  0.0  0.0   0:01.45 ksoftirqd/0
    5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H
    6 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kworker/u2:0
    7 root      rt   0       0      0      0 S  0.0  0.0   0:00.00 migration/0
    8 root      20   0       0      0      0 S  0.0  0.0   0:00.00 rcu_bh
    9 root      20   0       0      0      0 S  0.0  0.0   0:11.72 rcu_sched
   10 root      rt   0       0      0      0 S  0.0  0.0   0:01.45 watchdog/0
   12 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kdevtmpfs
   13 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 netns
   14 root      20   0       0      0      0 S  0.0  0.0   0:00.07 khungtaskd
   15 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 writeback
   16 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kintegrityd
   17 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 bioset
```

## 6. `du -sh`

计算并显示指定目录占用的空间。

选项：

* `-s` 显示汇总的大小
* `-h` 以较高可读性来显示

```shell
➜  ~ du -s github/nodejs-admin
66236 github/nodejs-admin

➜  ~ du -sh github/nodejs-admin
65M   github/nodejs-admin
```

## 7. find

## 8. service

## 9. kill

## 10. shutdown